import{P as B,M as S}from"./bootstrap.esm-45abc078.js";import{S as V}from"./sweetalert2.all-2d9b9108.js";import{_ as E,r as P,o as c,c as a,b as e,d,w as A,h as p,j as v,F as y,f as L,t as _,g as M,n as b,v as U,k as D}from"./index-30b6f64c.js";const{VITE_URL:k,VITE_PATH:x}={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"payroom",BASE_URL:"/week7/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},R={props:["tempProduct","isNew","closeModal","getProducts"],data(){return{newProduct:{},loadingItem:""}},methods:{updateProduct(){this.loadingItem="confirmButton";let s="post",t=`${k}/v2/api/${x}/admin/product`;this.isNew||(t+=`/${this.tempProduct.id}`,s="put"),this.$http[s](t,{data:this.newProduct}).then(()=>{V.fire({icon:"success",title:`${s==="put"?"修改成功":"新增成功"}`,showConfirmButton:!1,timer:1500,didClose:()=>{this.closeModal(),this.getProducts()}})}).catch(i=>{console.log(i)}).finally(()=>{this.loadingItem=""})},uploadImage(s){let t=document.querySelector("#formFile");this.loadingItem="images",s==="main"&&(t=document.querySelector("#mainImage"),this.loadingItem="mainImage");const i=new FormData;i.append("file-to-upload",t.files[0]),this.$http.post(`${k}/v2/api/${x}/admin/upload`,i).then(r=>{r.data.imageUrl?s==="main"?this.newProduct.imageUrl=r.data.imageUrl:s==="multi"&&this.newProduct.imagesUrl.push(r.data.imageUrl):alert(r.data.message),t.value="",this.loadingItem=""}).catch(r=>{alert(r)})}},watch:{tempProduct(){this.newProduct={...this.tempProduct}}}},N={class:"modal-dialog modal-dialog-centered modal-xl modal-dialog-scrollable"},F={class:"modal-content"},q={class:"modal-header bg-light"},O={class:"modal-title",id:"productModalLabel"},H={key:0},j={key:1},z={class:"modal-body"},W={class:"col-4"},G={class:"mb-5"},J=e("label",{for:"imageUrl",class:"form-label"},"主要圖片",-1),K={class:"mb-3"},Q=["disabled"],X=["src"],Y=e("h4",null,"多圖新增",-1),Z={key:0},$={class:"d-flex justify-content-space-between"},ee=["for"],te=["onClick"],oe=["onUpdate:modelValue","id"],le=["src"],se={key:0},ne=e("p",{class:"text-center"},"或",-1),ie={class:"mb-3"},de=["disabled"],ce={class:"col-8"},ae={class:"row gy-3"},re={class:"col-12"},ue=e("label",{for:"productTitle",class:"form-label"},"商品名稱:",-1),me={class:"col-6"},pe=e("label",{for:"productCategory",class:"form-label"},"分類:",-1),_e={class:"col-6"},he=e("label",{for:"productUnit",class:"form-label"},"單位:",-1),ge={class:"col-6"},fe=e("label",{for:"productOriginPrice",class:"form-label"},"原價:",-1),be={class:"col-6"},Pe=e("label",{for:"productPrice",class:"form-label"},"售價:",-1),ve={class:"col-4"},we=e("label",{for:"productTag",class:"form-label"},"標籤",-1),ye=e("option",{selected:"",value:"策略"},"策略",-1),Ue=e("option",{value:"家庭"},"家庭",-1),Ve=e("option",{value:"派對"},"派對",-1),Me=[ye,Ue,Ve],Ce={class:"col-4"},ke=e("label",{for:"productLanguage",class:"form-label"},"語言",-1),xe=e("option",{selected:"",value:"繁中"},"繁中",-1),Ie=e("option",{value:"簡中"},"簡中",-1),Te=e("option",{value:"英文"},"英文",-1),Ee=[xe,Ie,Te],Le={class:"col-4"},Be=e("label",{for:"productCondition",class:"form-label"},"盒況",-1),Se=e("option",{selected:"",value:"盒損"},"盒損",-1),Ae=e("option",{value:"件損"},"件損",-1),De=e("option",{value:"完好"},"完好",-1),Re=e("option",{value:"其他"},"其他",-1),Ne=[Se,Ae,De,Re],Fe=e("hr",null,null,-1),qe={class:"col-12"},Oe=e("label",{for:"productDescription",class:"form-label"},"描述:",-1),He={class:"col-12"},je=e("label",{for:"productContent",class:"form-label"},"內容:",-1),ze=e("label",{for:"is_enabled",class:"form-label"},"是否啟用",-1),We={class:"modal-footer"},Ge=["disabled"];function Je(s,t,i,r,o,u){const h=P("VField"),g=P("ErrorMessage"),n=P("VForm");return c(),a("div",N,[e("div",F,[e("div",q,[e("h5",O,[i.isNew?(c(),a("span",H,"新增產品")):(c(),a("span",j,"編輯產品"))]),e("button",{type:"button",class:"btn-close",onClick:t[0]||(t[0]=m=>i.closeModal()),"aria-label":"Close"})]),e("div",z,[d(n,{onSubmit:u.updateProduct,class:"row",ref:"ProductModal",id:"ProductModal"},{default:A(({errors:m})=>[e("div",W,[e("div",G,[J,p(e("input",{type:"text",placeholder:"請輸入圖片連結",id:"imageUrl",class:"form-control mb-2","onUpdate:modelValue":t[1]||(t[1]=l=>o.newProduct.imageUrl=l)},null,512),[[v,o.newProduct.imageUrl]]),e("div",K,[e("input",{class:"form-control",type:"file",id:"mainImage",onChange:t[2]||(t[2]=l=>u.uploadImage("main")),disabled:o.loadingItem==="mainImage"},null,40,Q)]),e("img",{src:o.newProduct.imageUrl,alt:"",class:"img-fluid"},null,8,X)]),e("div",null,[Y,Array.isArray(o.newProduct.imagesUrl)?(c(),a("div",Z,[(c(!0),a(y,null,L(o.newProduct.imagesUrl,(l,f)=>(c(),a(y,{key:f+5566},[e("div",$,[e("label",{for:l,class:"form-label"},"圖片網址"+_(f+1),9,ee),e("button",{type:"button",class:"btn-close btn-sm ms-auto","aria-label":"removeImage",onClick:C=>o.newProduct.imagesUrl.splice(f,1)},null,8,te)]),p(e("input",{type:"text",placeholder:"請輸入圖片連結",class:"form-control mb-1","onUpdate:modelValue":C=>o.newProduct.imagesUrl[f]=C,id:l},null,8,oe),[[v,o.newProduct.imagesUrl[f]]]),e("img",{src:l,alt:"",class:"img-fluid mb-4"},null,8,le)],64))),128)),o.newProduct.imagesUrl[o.newProduct.imagesUrl.length-1]||!o.newProduct.imagesUrl.length?(c(),a("div",se,[e("button",{class:"btn btn-outline-primary w-100 mb-3",type:"button",onClick:t[3]||(t[3]=l=>o.newProduct.imagesUrl.push(""))}," 新增圖片網址 "),ne,e("div",ie,[e("input",{class:"form-control",type:"file",id:"formFile",onChange:t[4]||(t[4]=l=>u.uploadImage("multi")),disabled:o.loadingItem==="images"},null,40,de)])])):M("",!0)])):M("",!0)])]),e("div",ce,[e("div",ae,[e("div",re,[ue,d(h,{id:"productTitle",name:"商品名稱",type:"text",class:b(["form-control",{"is-invalid":m.商品名稱}]),placeholder:"請輸入 商品名稱",rules:"required",modelValue:o.newProduct.title,"onUpdate:modelValue":t[5]||(t[5]=l=>o.newProduct.title=l)},null,8,["class","modelValue"]),d(g,{name:"商品名稱",class:"invalid-feedback"})]),e("div",me,[pe,d(h,{id:"productCategory",name:"分類",type:"text",class:b(["form-control",{"is-invalid":m.分類}]),placeholder:"請輸入 分類",rules:"required",modelValue:o.newProduct.category,"onUpdate:modelValue":t[6]||(t[6]=l=>o.newProduct.category=l)},null,8,["class","modelValue"]),d(g,{name:"分類",class:"invalid-feedback"})]),e("div",_e,[he,d(h,{id:"productUnit",name:"單位",type:"text",class:b(["form-control",{"is-invalid":m.單位}]),placeholder:"請輸入 單位",rules:"required",modelValue:o.newProduct.unit,"onUpdate:modelValue":t[7]||(t[7]=l=>o.newProduct.unit=l)},null,8,["class","modelValue"]),d(g,{name:"單位",class:"invalid-feedback"})]),e("div",ge,[fe,d(h,{id:"productOriginPrice",name:"原價",type:"number",class:b(["form-control",{"is-invalid":m.原價}]),placeholder:"請輸入 原價",rules:{min_value:0,required:!0},modelValue:o.newProduct.origin_price,"onUpdate:modelValue":t[8]||(t[8]=l=>o.newProduct.origin_price=l),modelModifiers:{number:!0}},null,8,["class","modelValue"]),d(g,{name:"原價",class:"invalid-feedback"})]),e("div",be,[Pe,d(h,{id:"productPrice",name:"售價",type:"number",class:b(["form-control",{"is-invalid":m.售價}]),placeholder:"請輸入 售價",rules:{min_value:0,required:!0},modelValue:o.newProduct.price,"onUpdate:modelValue":t[9]||(t[9]=l=>o.newProduct.price=l),modelModifiers:{number:!0}},null,8,["class","modelValue"]),d(g,{name:"售價",class:"invalid-feedback"})]),e("div",ve,[we,p(e("select",{class:"form-select","aria-label":"tag","onUpdate:modelValue":t[10]||(t[10]=l=>o.newProduct.tag=l),id:"productTag"},Me,512),[[U,o.newProduct.tag]])]),e("div",Ce,[ke,p(e("select",{class:"form-select","aria-label":"tag","onUpdate:modelValue":t[11]||(t[11]=l=>o.newProduct.language=l),id:"productLanguage"},Ee,512),[[U,o.newProduct.language]])]),e("div",Le,[Be,p(e("select",{class:"form-select","aria-label":"tag","onUpdate:modelValue":t[12]||(t[12]=l=>o.newProduct.condition=l),id:"productCondition"},Ne,512),[[U,o.newProduct.condition]])]),Fe,e("div",qe,[Oe,p(e("textarea",{id:"productDescription",rows:"3",class:"form-control","onUpdate:modelValue":t[13]||(t[13]=l=>o.newProduct.description=l)},null,512),[[v,o.newProduct.description]])]),e("div",He,[je,p(e("textarea",{id:"productContent",rows:"3",class:"form-control","onUpdate:modelValue":t[14]||(t[14]=l=>o.newProduct.content=l)},null,512),[[v,o.newProduct.content]])]),e("div",null,[p(e("input",{type:"checkbox",id:"is_enabled",class:"form-check-input","onUpdate:modelValue":t[15]||(t[15]=l=>o.newProduct.is_enabled=l),"true-value":1,"false-value":0},null,512),[[D,o.newProduct.is_enabled]]),ze])])])]),_:1},8,["onSubmit"])]),e("div",We,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[16]||(t[16]=(...m)=>i.closeModal&&i.closeModal(...m))}," 取消 "),e("button",{type:"submit",class:"btn btn-primary",disabled:o.loadingItem==="confirmButton",form:"ProductModal"}," 確認 ",8,Ge)])])])}const Ke=E(R,[["render",Je]]);const{VITE_URL:I,VITE_PATH:T}={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"payroom",BASE_URL:"/week7/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};let w={};const Qe={data(){return{products:[],tempProduct:{imagesUrl:[],imageUrl:""},isNew:!0,page:{},isLoading:!1}},components:{PaginationComponent:B,ProductModal:Ke},methods:{getProducts(s=1){this.isLoading=!0,this.$http.get(`${I}/v2/api/${T}/admin/products?page=${s}`).then(t=>{this.products=t.data.products,this.page=t.data.pagination}).catch(t=>{console.log(t)}).finally(()=>{this.isLoading=!1})},openModal(s,t){s==="new"?(this.isNew=!0,this.tempProduct={imageUrl:"",imagesUrl:[]},w.show()):s==="edit"&&(this.isNew=!1,this.tempProduct={...t},w.show()),this.tempProduct.imagesUrl||(this.tempProduct.imagesUrl=[])},closeModal(){this.tempProduct={imagesUrl:[]},w.hide()},deleteProduct(s,t){V.fire({title:`確定刪除${s}嗎?`,text:"刪除後不可復原，確定嗎?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",confirmButtonText:"確定",cancelButtonColor:"#d33",cancelButtonText:"取消"}).then(i=>{i.isConfirmed&&(this.isLoading=!0,this.$http.delete(`${I}/v2/api/${T}/admin/product/${t}`).then(()=>{this.isLoading=!1,V.fire({icon:"success",title:`${s}刪除成功`,showConfirmButton:!1,timer:1e3,didClose:()=>{this.getProducts()}})}).catch(r=>{console.log(r)}))})}},mounted(){var t;const s=(t=document.cookie.split("; ").find(i=>i.startsWith("myToken=")))==null?void 0:t.split("=")[1];this.$http.defaults.headers.common.Authorization=s,this.getProducts(),w=new S("#productModal")}},Xe={class:"row justify-content-center"},Ye={class:"col"},Ze={class:"text-end"},$e=e("h2",{class:"h2 text-center"},"產品列表",-1),et={class:"table table-hover align-middle"},tt=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"圖片"),e("th",{scope:"col"},"產品名稱"),e("th",{scope:"col"},"類型"),e("th",{scope:"col"},"語言"),e("th",{scope:"col"},"盒況"),e("th",{scope:"col"},"原價"),e("th",{scope:"col"},"售價"),e("th",{scope:"col"},"是否啟用"),e("th",{scope:"col"},"編輯")])],-1),ot=["src"],lt={key:0,class:"text-success"},st={key:1,class:"text-danger"},nt=["onClick"],it=["onClick"],dt={colspan:"9",class:"text-center"},ct={class:"modal fade",id:"productModal","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"};function at(s,t,i,r,o,u){const h=P("PaginationComponent"),g=P("ProductModal");return c(),a(y,null,[e("div",Xe,[e("div",Ye,[e("div",Ze,[e("button",{type:"button",class:"btn btn-primary",onClick:t[0]||(t[0]=n=>u.openModal("new"))}," 建立新的產品 ")]),$e,e("table",et,[tt,e("tbody",null,[o.products?(c(!0),a(y,{key:0},L(o.products,n=>(c(),a("tr",{key:n.id},[e("td",null,[e("img",{src:n.imageUrl,alt:"productImage",class:"product-image",onerror:"this.src='../../../public/no_image_icon.png'"},null,8,ot)]),e("td",null,_(n.title),1),e("td",null,_(n.tag),1),e("td",null,_(n.language),1),e("td",null,_(n.condition),1),e("td",null,_(n.origin_price),1),e("td",null,_(n.price),1),e("td",null,[n.is_enabled?(c(),a("span",lt,"啟用")):(c(),a("span",st,"未啟用"))]),e("td",null,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm me-2",onClick:m=>u.openModal("edit",n)}," 編輯 ",8,nt),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:m=>u.deleteProduct(n.title,n.id)}," 刪除 ",8,it)])]))),128)):M("",!0)]),e("tfoot",null,[e("tr",null,[e("td",dt," 本頁有"+_(o.products.length)+"項產品 ",1)])])]),d(h,{pages:o.page,"get-Method":u.getProducts},null,8,["pages","get-Method"])])]),e("div",ct,[d(g,{"temp-product":o.tempProduct,"is-new":o.isNew,"close-Modal":u.closeModal,"get-Products":u.getProducts},null,8,["temp-product","is-new","close-Modal","get-Products"])])],64)}const pt=E(Qe,[["render",at]]);export{pt as default};
